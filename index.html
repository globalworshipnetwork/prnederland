<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Praise FM Nederland - Live</title>
    <meta name="theme-color" content="#1a365d">
    <link rel="icon" type="image/png" sizes="32x32" href="/image/favicon-32x32.png">
    <link rel="manifest" href="/manifest.json">
    <style>
        :root { --primary:#1a365d; --dark:#111; --grey:#555; --light-grey:#888; --bg:#fff; --border-color:#ddd; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; }
        body { background:var(--bg); color:#000; min-height:100vh; padding-bottom:120px; display:flex; flex-direction:column; align-items:center; }
        .container { width:100%; max-width:900px; padding:20px; text-align:center; }
        .station-title { font-size:32px; font-weight:900; color:var(--primary); margin:20px 0 4px; }
        .station-subtitle { font-size:17px; color:var(--grey); margin-bottom:30px; }
        .circle-container { width:min(80vw,320px); height:min(80vw,320px); margin:0 auto 20px; position:relative; }
        .circle-border { position:absolute; inset:0; border-radius:50%; background:conic-gradient(var(--primary) 0%, transparent 0%);
            mask:radial-gradient(transparent 68%, black 70%); -webkit-mask:radial-gradient(transparent 68%, black 70%); }
        .circle-img { position:absolute; inset:6px; border-radius:50%; overflow:hidden; background:#000; }
        .circle-img img { width:100%; height:100%; object-fit:cover; }
        .live-badge { display:inline-flex; align-items:center; gap:8px; color:var(--primary); font-weight:700; font-size:14px; text-transform:uppercase; letter-spacing:1px; margin-bottom:12px; }
        .live-dot { width:9px; height:9px; background:var(--primary); border-radius:50%; animation:pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
        .program-title { font-size:28px; font-weight:800; margin:10px 0 30px; line-height:1.2; }
        .play-button { margin:40px auto; width:220px; height:56px; background:var(--primary); color:#fff; border:none; border-radius:28px; font-size:18px; font-weight:700; cursor:pointer;
            display:flex; align-items:center; justify-content:center; gap:8px; box-shadow:0 6px 20px rgba(26,54,93,.3); transition:transform .2s; }
        .play-button:hover { transform:scale(1.05); }
        .play-button svg { width:24px; height:24px; fill:#fff; margin-left:10px; }

        /* ðŸ“‹ Open Play Queue Drawer */
        .play-queue-drawer {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: var(--bg);
            border-left: 1px solid var(--border-color);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 9999;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .play-queue-drawer.open {
            right: 0;
        }
        .play-queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .play-queue-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        .play-queue-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--grey);
            padding: 4px;
        }
        .play-queue-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            align-items: flex-start;
        }
        .play-queue-img {
            width: 60px;
            height: 60px;
            border-radius: 0;
            object-fit: cover;
            background: #eee;
        }
        .play-queue-content {
            flex: 1;
            min-width: 0;
        }
        .play-queue-time {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .play-queue-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .play-queue-desc {
            font-size: 14px;
            color: var(--grey);
        }

        .queue-toggle {
            background: #f8f8f8;
            color: var(--primary);
            border: none;
            font-weight: 700;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            margin: 30px auto;
            display: block;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .queue-toggle:hover { background: #eee; }
        .queue-toggle svg { width: 16px; height: 16px; fill: var(--primary); }

        .recently { margin-top:40px; text-align:left; }
        .recently-header { font-size:13px; font-weight:700; color:var(--grey); text-transform:uppercase; letter-spacing:1px; margin-bottom:12px; }
        .recent-item { display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid var(--border-color); }
        .recent-cover { width:48px; height:48px; border-radius:0; object-fit:cover; background:#eee; }
        .recent-title { font-weight:600; font-size:15px; }
        .recent-artist { font-size:13px; color:var(--light-grey); }
        .mini-player {
            position:fixed; bottom:0; left:0; right:0; background:#fff; border-top:1px solid var(--border-color);
            box-shadow:0 -4px 20px rgba(0,0,0,.1); padding:12px 16px; display:none; flex-direction:column; gap:10px; z-index:999;
        }
        .mini-player.show { display:flex; }
        .mini-player-content { display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap; }
        .mini-cover { width:56px; height:56px; border-radius:0; object-fit:cover; background:#eee; }
        .mini-info { flex:1; min-width:0; }
        .mini-title { font-weight:700; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .mini-artist { font-size:13px; color:var(--grey); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .mini-controls { display:flex; align-items:center; gap:16px; }
        .mini-btn { background:none; border:none; cursor:pointer; padding:8px; }
        .mini-btn svg { width:24px; height:24px; fill:var(--grey); }
        .mini-play { background:var(--primary); width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:none; cursor:pointer; box-shadow:0 2px 12px rgba(26,54,93,.35); }
        .mini-play svg { width:20px; height:20px; fill:#fff; }
        .mini-volume { display:flex; align-items:center; gap:4px; width:100px; }
        .mini-volume-bar { flex:1; height:4px; background:#ddd; border-radius:2px; position:relative; cursor:pointer; }
        .mini-volume-fill { height:100%; background:var(--primary); border-radius:2px; width:80%; }
        .mini-track-progress { width:100%; padding:6px 0; }
        .mini-track-bar { width:100%; height:4px; background:#ddd; border-radius:2px; position:relative; cursor:pointer; }
        .mini-track-fill { height:100%; background:var(--primary); border-radius:2px; width:0%; }
        .mini-track-time { display:flex; justify-content:space-between; font-size:11px; color:var(--light-grey); margin-top:4px; }
        @media (max-width:480px) { 
            .mini-player { padding:10px; } 
            .mini-player-content { flex-direction:column; align-items:flex-start; gap:14px; } 
            .mini-play { width:64px; height:64px; }
            .circle-container { width:260px; height:260px; }
            .program-title { font-size:24px; }
            .mini-controls { gap:10px; }
            .mini-volume { width:80px; }
            .play-queue-drawer { width: 100%; right: -100%; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="station-title">Praise FM Nederland</h1>
    <p class="station-subtitle">Continue Aanbidding</p>
    <div class="circle-container">
        <div class="circle-border" id="progressRing"></div>
        <div class="circle-img">
            <img id="mainImg" src="/image/logo-nl.webp" alt="Nu aan het spelen">
        </div>
    </div>
    <div class="live-badge"><div class="live-dot"></div> LIVE</div>
    <h2 class="program-title" id="programTitle">Praise FM Nederland</h2>
    <button class="play-button" id="bigPlay">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> Afspelen
    </button>

    <!-- ðŸ‡³ðŸ‡± Open Play Queue -->
    <button class="queue-toggle" id="openQueueBtn">
        <svg viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6h18v2H3V6zm0 5h18v2H3v-2z"/></svg>
        Open afspeelwachtrij
    </button>

    <div class="recently">
        <div class="recently-header">Recent gespeeld</div>
        <div id="recentList"></div>
    </div>
</div>

<!-- Drawer -->
<div class="play-queue-drawer" id="playQueueDrawer">
    <div class="play-queue-header">
        <h3>Programma</h3>
        <button class="play-queue-close" id="closeQueueBtn">Ã—</button>
    </div>
    <div id="playQueueList"></div>
</div>

<div class="mini-player" id="miniPlayer">
    <div class="mini-player-content">
        <img id="miniImg" src="/image/logo-nl.webp" class="mini-cover">
        <div class="mini-info">
            <div class="mini-title" id="miniTitle">Praise FM Nederland</div>
            <div class="mini-artist" id="miniArtist">Continue Aanbidding</div>
            <div class="mini-track-progress">
                <div class="mini-track-bar" id="miniTrackBar">
                    <div class="mini-track-fill" id="miniTrackFill" style="width:0%"></div>
                </div>
                <div class="mini-track-time">
                    <span id="miniTrackCurrent">0:00</span>
                    <span id="miniTrackDuration">0:00</span>
                </div>
            </div>
        </div>
        <div class="mini-controls">
            <button class="mini-btn" id="miniRewind">
                <svg viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg>
            </button>
            <button class="mini-play" id="miniPlayPause">
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button class="mini-btn" id="miniForward">
                <svg viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg>
            </button>
            <div class="mini-volume">
                <button class="mini-btn" id="miniVolumeIcon">
                    <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                </button>
                <div class="mini-volume-bar" id="miniVolumeBar">
                    <div class="mini-volume-fill" id="miniVolumeFill"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ConfiguraÃ§Ãµes especÃ­ficas da NL
    const STREAM_URL = "/api/stream";
    const audio = new Audio(STREAM_URL);
    audio.volume = 0.8;

    const images = {
        default: "/image/logo-nl.webp",
        nachtgenade: "/image/nachtgenade.webp",
        aanbidding: "/image/aanbidding.webp",
        ochtendshow: "/image/ochtendshow.webp",
        middaggenade: "/image/middaggenade.webp",
        zondag: "/image/zondag.webp",
        pop: "/image/pop.webp",
        thuisreis: "/image/thuisreis.webp",
        commercial: "/image/commerciell.png",
        spot: "/image/spot.png"
    };

    const hosts = {
        "Ochtendshow": "Lieke van Dijk",
        "Middaggenade": "Daan Bakker",
        "Zondag met Christus": "Joris de Wit",
        "Praise FM POP": "Luuk Vermeulen",
        "Praise FM Thuisreis": "Eva de Jong",
        "Nachtgenade": "Fleur Jansen"
    };

    const schedule = [
        {start:"00:00", end:"06:00", name:"Nachtgenade", img:images.nachtgenade, desc: "Fleur Jansen omhult u met stilte en gebed."},
        {start:"06:00", end:"07:00", name:"Praise FM Aanbidding", img:images.aanbidding, desc: "Continue stroom van aanbidding."},
        {start:"07:00", end:"12:00", name:"Ochtendshow", img:images.ochtendshow, days:[1,2,3,4,5,6], desc: "Lieke van Dijk begroet u met opbouwende lof."},
        {start:"07:00", end:"12:00", name:"Zondag met Christus", img:images.zondag, days:[0], desc: "Joris de Wit deelt geestelijke inzichten."},
        {start:"12:00", end:"16:00", name:"Middaggenade", img:images.middaggenade, desc: "Daan Bakker brengt u vrede en lof midden in de drukte van de middag."},
        {start:"16:00", end:"17:00", name:"Praise FM Aanbidding", img:images.aanbidding, desc: "Continue stroom van aanbidding."},
        {start:"17:00", end:"18:00", name:"Praise FM POP", img:images.pop, desc: "Luuk Vermeulen presenteert de nieuwste lofzangen."},
        {start:"18:00", end:"20:00", name:"Praise FM Thuisreis", img:images.thuisreis, days:[1,2,3,4,5], desc: "Eva de Jong begeleidt u naar huis."},
        {start:"18:00", end:"20:00", name:"Praise FM Aanbidding", img:images.aanbidding, days:[0,6], desc: "Continue stroom van aanbidding."},
        {start:"20:00", end:"00:00", name:"Praise FM Aanbidding", img:images.aanbidding, desc: "Continue stroom van aanbidding."}
    ];

    function getTime() { 
        return new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/Amsterdam" })); 
    }
    function timeToMins(t) { 
        const [h,m] = t.split(":").map(Number); 
        return h * 60 + m; 
    }

    function getCurrentAndNext() {
        const now = getTime();
        const day = now.getDay();
        const mins = timeToMins(now.toTimeString().slice(0,5));
        let current = null;
        const future = [];
        for (const p of schedule) {
            if (p.days && !p.days.includes(day)) continue;
            const s = timeToMins(p.start);
            const e = timeToMins(p.end);
            const end = e <= s ? e + 1440 : e;
            if (mins >= s && mins < end) {
                if (!current || end > timeToMins(current.end)) current = p;
            }
            if (mins < s) future.push({prog: p, startMins: s});
        }
        if (future.length === 0) {
            const tomorrow = (day + 1) % 7;
            for (const p of schedule) {
                if (!p.days || p.days.includes(tomorrow)) future.push({prog: p, startMins: timeToMins(p.start)});
            }
        }
        future.sort((a,b) => a.startMins - b.startMins);
        return {
            current: current || {name: "Praise FM Nederland", img: images.default, start: null, end: null},
            next1: future[0]?.prog || schedule[0],
            next2: future[1]?.prog || schedule[1]
        };
    }

    function formatProgramName(p) {
        if (!p) return "Praise FM Nederland";
        const base = p.name.replace(/ \([^)]*\)$/, '').trim();
        if (["Praise FM Aanbidding", "Praise FM POP"].includes(base)) {
            return base;
        }
        const host = hosts[base] || "Praise FM";
        return `${base} met ${host}`;
    }

    function formatRange(p) {
        const [sh, sm] = p.start.split(":").map(Number);
        const [eh, em] = p.end.split(":").map(Number);
        const sSuffix = sh >= 12 ? "PM" : "AM";
        const eSuffix = eh >= 12 ? "PM" : "AM";
        const sHour = ((sh + 11) % 12) + 1;
        const eHour = ((eh + 11) % 12) + 1;
        return `${sHour}:${sm.toString().padStart(2, '0')} ${sSuffix} - ${eHour}:${em.toString().padStart(2, '0')} ${eSuffix}`;
    }

    // ðŸ“‹ Render Play Queue (NL)
    function renderPlayQueue() {
        const now = getTime();
        const day = now.getDay();
        const currentMins = timeToMins(now.toTimeString().slice(0,5));
        let futureProgs = [];
        for (const p of schedule) {
            if (p.days && !p.days.includes(day)) continue;
            const startMins = timeToMins(p.start);
            if (startMins > currentMins) {
                futureProgs.push(p);
            }
        }
        if (futureProgs.length === 0) {
            const nextDay = (day + 1) % 7;
            for (const p of schedule) {
                if (!p.days || p.days.includes(nextDay)) {
                    futureProgs.push(p);
                }
            }
            futureProgs = futureProgs.slice(0, 5);
        }
        const container = document.getElementById("playQueueList");
        if (futureProgs.length === 0) {
            container.innerHTML = "<p style='text-align:center; padding:20px; color:var(--grey);'>Geen programma's gepland.</p>";
            return;
        }
        container.innerHTML = futureProgs.map(prog => `
            <div class="play-queue-item">
                <img src="${prog.img || images.default}" class="play-queue-img" onerror="this.src='${images.default}'">
                <div class="play-queue-content">
                    <div class="play-queue-time">${formatRange(prog)}</div>
                    <div class="play-queue-title">${formatProgramName(prog)}</div>
                    <div class="play-queue-desc">${prog.desc || "-"}</div>
                </div>
            </div>
        `).join("");
    }

    // ðŸ“‹ Toggle Play Queue
    document.getElementById("openQueueBtn").addEventListener("click", () => {
        document.getElementById("playQueueDrawer").classList.add("open");
        renderPlayQueue();
    });
    document.getElementById("closeQueueBtn").addEventListener("click", () => {
        document.getElementById("playQueueDrawer").classList.remove("open");
    });
    document.addEventListener("click", (e) => {
        const drawer = document.getElementById("playQueueDrawer");
        const btn = document.getElementById("openQueueBtn");
        if (drawer.classList.contains("open") && !drawer.contains(e.target) && e.target !== btn) {
            drawer.classList.remove("open");
        }
    });

    // === RESTANTE DO PLAYER (igual ao seu cÃ³digo NL original) ===
    let currentTrack = {title: "", artist: "", duration: 0, startTime: 0};
    const recents = [];
    let trackTimer = null;

    function formatTime(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    function updateProgramProgress() {
        const {current} = getCurrentAndNext();
        const now = getTime();
        if (current.start && current.end) {
            const s = timeToMins(current.start);
            const e = timeToMins(current.end);
            const n = timeToMins(now.toTimeString().slice(0,5));
            const total = (e - s + 1440) % 1440;
            const elapsed = (n - s + 1440) % 1440;
            const pct = total > 0 ? (elapsed / total) * 100 : 0;
            document.getElementById("miniTrackFill").style.width = `${pct}%`;
            document.getElementById("miniTrackCurrent").textContent = formatTime(elapsed);
            document.getElementById("miniTrackDuration").textContent = formatTime(total);
        } else {
            document.getElementById("miniTrackFill").style.width = "0%";
            document.getElementById("miniTrackCurrent").textContent = "--:--";
            document.getElementById("miniTrackDuration").textContent = "Live";
        }
    }

    async function fetchAlbumCover(artist, title) {
        if (!artist || !title) return images.default;
        const query = encodeURIComponent(`${artist} ${title}`);
        const url = `https://itunes.apple.com/search?term=${query}&entity=song&limit=1`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            if (data.results?.[0]?.artworkUrl100) {
                return data.results[0].artworkUrl100.replace('100x100', '600x600');
            }
        } catch (e) {}
        return images.default;
    }

    async function processMetadata(artist, title) {
        if (trackTimer) clearInterval(trackTimer);
        const lowerTitle = title.toLowerCase();
        if (lowerTitle.includes("commercial") || lowerTitle.includes("ad") || lowerTitle.includes("commerciell")) {
            currentTrack = { title: "Commercial Break", artist: "Praise FM", duration: 0, startTime: 0 };
            document.getElementById("mainImg").src = images.commercial;
            document.getElementById("miniImg").src = images.commercial;
            return;
        }
        if (lowerTitle.includes("spot")) {
            currentTrack = { title: "Spot", artist: "Praise FM", duration: 0, startTime: 0 };
            document.getElementById("mainImg").src = images.spot;
            document.getElementById("miniImg").src = images.spot;
            return;
        }

        currentTrack = { title, artist, duration: 0, startTime: Date.now() };
        const cover = await fetchAlbumCover(artist, title);
        const key = `${artist}-${title}`;
        if (!recents.some(t => t.key === key)) {
            recents.unshift({ title, artist, cover, key });
            if (recents.length > 4) recents.pop();
            document.getElementById("recentList").innerHTML = recents.map(t => `
                <div class="recent-item">
                    <img src="${t.cover}" class="recent-cover" onerror="this.src='${images.default}'">
                    <div>
                        <div class="recent-title">${t.title}</div>
                        <div class="recent-artist">${t.artist}</div>
                    </div>
                </div>
            `).join("");
        }
        updateDisplay();
        trackTimer = setInterval(updateProgramProgress, 1000);
    }

    try {
        const es = new EventSource("https://api.zeno.fm/mounts/metadata/subscribe/olisuxy9v3vtv");
        es.onmessage = e => {
            try {
                const d = JSON.parse(e.data);
                if (d.streamTitle) {
                    const parts = d.streamTitle.split(" - ");
                    processMetadata(parts[0] || "", parts.slice(1).join(" - ") || "");
                }
            } catch {}
        };
    } catch(e) {}

    function togglePlay() {
        if (audio.paused) { audio.play(); document.getElementById("miniPlayer").classList.add("show"); }
        else audio.pause();
        const playing = !audio.paused;
        const playSvg = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
        const pauseSvg = '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        document.querySelector("#bigPlay").innerHTML = playing ? pauseSvg + ' Pauzeren' : playSvg + ' Afspelen';
        document.getElementById("miniPlayPause").innerHTML = playing ? pauseSvg : playSvg;
    }

    document.getElementById("bigPlay").onclick = togglePlay;
    document.getElementById("miniPlayPause").onclick = togglePlay;
    document.getElementById("miniRewind").onclick = () => audio.currentTime = Math.max(0, audio.currentTime - 15);
    document.getElementById("miniForward").onclick = () => audio.currentTime += 15;
    document.getElementById("miniVolumeBar").onclick = e => {
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        audio.volume = Math.max(0, Math.min(1, percent));
        audio.muted = false;
        document.getElementById("miniVolumeFill").style.width = (audio.volume*100)+'%';
    };
    document.getElementById("miniVolumeIcon").onclick = () => {
        audio.muted = !audio.muted;
        document.getElementById("miniVolumeIcon").innerHTML = audio.muted 
            ? '<svg viewBox="0 0 24 24"><path d="M16.5 12l4.5 4.5-1.5 1.5L15 13.5 11.5 17H7v-6h4.5L15 7.5l4.5-4.5 1.5 1.5L16.5 12z"/></svg>' 
            : '<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>';
    };

    function updateDisplay() {
        const {current, next1, next2} = getCurrentAndNext();
        document.getElementById("mainImg").src = current.img || images.default;
        document.getElementById("miniImg").src = current.img || images.default;
        const displayName = formatProgramName(current);
        document.getElementById("programTitle").textContent = displayName;
        document.getElementById("miniTitle").textContent = currentTrack.title || displayName;
        document.getElementById("miniArtist").textContent = currentTrack.artist || "Continue Aanbidding";

        if (current.start && current.end) {
            const s = timeToMins(current.start);
            const e = timeToMins(current.end);
            const n = timeToMins(getTime().toTimeString().slice(0,5));
            const total = (e - s + 1440) % 1440;
            const elapsed = (n - s + 1440) % 1440;
            const pct = total > 0 ? (elapsed / total) * 100 : 0;
            document.getElementById("progressRing").style.background = `conic-gradient(var(--primary) ${pct}%, transparent ${pct}%)`;
        } else {
            document.getElementById("progressRing").style.background = "conic-gradient(var(--primary) 0%, transparent 0%)";
        }
        updateProgramProgress();
    }

    setInterval(updateDisplay, 8000);
    updateDisplay();
</script>
</body>
</html>
